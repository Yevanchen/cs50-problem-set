{% extends "layout.html" %}

{% block title %}
    Buy
{% endblock %}

{% block main %}
    {% if stock %}
        <!-- Step 2: Stock Information and Purchase Confirmation -->
        <div class="mb-4">
            <h4>Stock Information</h4>
            <div class="mx-auto" style="max-width: 500px;">
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th scope="col">Name</th>
                            <th scope="col">Symbol</th>
                            <th scope="col">Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>{{ stock.name }}</td>
                            <td>{{ stock.symbol }}</td>
                            <td>{{ stock.price | usd }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card mx-auto" style="max-width: 500px;">
            <div class="card-header">
                <h4>Purchase Details</h4>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-6"><strong>Shares:</strong></div>
                    <div class="col-6">{{ shares }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-6"><strong>Total Cost:</strong></div>
                    <div class="col-6 text-primary h5">{{ (stock.price * shares) | usd }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-6"><strong>Your Cash:</strong></div>
                    <div class="col-6">{{ user_cash | usd }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-6"><strong>After Purchase:</strong></div>
                    <div class="col-6 {% if (user_cash - stock.price * shares) < 0 %}text-danger{% else %}text-success{% endif %}">
                        {{ (user_cash - stock.price * shares) | usd }}
                    </div>
                </div>
                
                {% if (user_cash - stock.price * shares) < 0 %}
                    <div class="alert alert-danger">
                        Insufficient funds! You need {{ ((stock.price * shares) - user_cash) | usd }} more.
                    </div>
                {% else %}
                    <form action="/buy" method="post">
                        <input type="hidden" name="symbol" value="{{ stock.symbol }}">
                        <input type="hidden" name="shares" value="{{ shares }}">
                        <input type="hidden" name="confirm" value="true">
                        <button class="btn btn-success btn-lg" type="submit">Confirm Purchase</button>
                    </form>
                {% endif %}
                
                <div class="mt-3">
                    <a href="/buy" class="btn btn-secondary btn-lg">Buy Another Stock</a>
                </div>
            </div>
        </div>
    {% else %}
        <!-- Step 1: Input Form -->
        <div class="card mx-auto" style="max-width: 500px;">
            <div class="card-header">
                <h4>Buy Shares</h4>
            </div>
            <div class="card-body">
                <form action="/buy" method="post">
                    <div class="mb-3">
                        <label for="symbol" class="form-label">Stock Symbol</label>
                        <input autocomplete="off" autofocus class="form-control" id="symbol" name="symbol" placeholder="e.g., AAPL" type="text" required>
                        <div class="form-text">Enter the stock's ticker symbol (e.g., AAPL for Apple)</div>
                    </div>
                    <div class="mb-3">
                        <label for="shares" class="form-label">Number of Shares</label>
                        <input autocomplete="off" class="form-control" id="shares" name="shares" placeholder="e.g., 10" type="number" min="1" required>
                        <div class="form-text">How many shares would you like to buy?</div>
                    </div>
                    <button class="btn btn-primary btn-lg" type="submit">Look Up Stock</button>
                </form>
                
                <hr class="my-4">
                
                <div class="mb-3">
                    <h6>Popular Stocks to Buy:</h6>
                    <div class="row g-2">
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-success btn-sm w-100" onclick="setSymbol('AAPL')">
                                AAPL - Apple
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-success btn-sm w-100" onclick="setSymbol('MSFT')">
                                MSFT - Microsoft
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-success btn-sm w-100" onclick="setSymbol('GOOGL')">
                                GOOGL - Google
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-success btn-sm w-100" onclick="setSymbol('TSLA')">
                                TSLA - Tesla
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-success btn-sm w-100" onclick="setSymbol('AMZN')">
                                AMZN - Amazon
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-success btn-sm w-100" onclick="setSymbol('META')">
                                META - Meta
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-success btn-sm w-100" onclick="setSymbol('NVDA')">
                                NVDA - NVIDIA
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-success btn-sm w-100" onclick="setSymbol('BRK.A')">
                                BRK.A - Berkshire
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-success">
                    <small>
                        <strong>Investment Tip:</strong> Consider diversifying your portfolio by investing in different sectors and companies. 
                        Research the company's financials before making investment decisions.
                    </small>
                </div>
            </div>
        </div>
    {% endif %}
    
    <script>
        function setSymbol(symbol) {
            document.getElementById('symbol').value = symbol;
            document.getElementById('symbol').focus();
        }
    </script>
{% endblock %}
